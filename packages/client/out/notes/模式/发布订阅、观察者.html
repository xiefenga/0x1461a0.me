<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>发布订阅、观察者 | 0X1461A0</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/5db4aa1edde4971b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5db4aa1edde4971b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c642bc88044b6e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c642bc88044b6e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-325eacbb81921a43.js" defer=""></script><script src="/_next/static/chunks/main-c87967b003e3efc2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-111c29f79e705983.js" defer=""></script><script src="/_next/static/chunks/542-e750f8bef0aa06d2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B%5B...param%5D%5D-4c9f87d1f418ba6e.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_buildManifest.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="pb-10 pt-12 text-center shrink-0"><a class="uppercase tracking-widest text-gray-600" href="/">0x1461a0</a></header><main class="flex-auto mb-12"><div class="TOC_table-of-content__KyR_J"><ul><li><a href="#观察者模式" data-target-id="h2-观察者模式-0">观察者模式</a></li><li><a href="#发布订阅模式" data-target-id="h2-发布订阅模式-1">发布订阅模式</a></li><li><a href="#区别" data-target-id="h2-区别-2">区别</a></li></ul></div><div class="article_article-container__yUBmR"><div class="mb-8"><h1 data-title="true" class="mb-0">发布订阅、观察者</h1><p class="opacity-50 !-mt-2"><span>Post: <!-- -->2022.09.18</span><span class="font-bold">·</span><span>Update: <!-- -->2022.09.18</span></p></div><h2>观察者模式</h2>
<p>观察者模式定义了对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知并自动更新。</p>
<p>观察者模式属于行为型模式，行为型模式关注的是对象之间的通讯，观察者模式就是观察者和被观察者之间的通讯</p>
<p>观察者模式又叫做发布-订阅（Publish/Subscribe）模式，订阅者和订阅目标是联系在一起的，当订阅目标发生改变时，逐个通知订阅者</p>
<ul>
<li>气象站可以将每天预测到的温度、湿度、气压等以公告的形式发布给各种第三方网站</li>
<li>MVC 模式中的模型与视图的关系也属于观察与被观察</li>
</ul>
<pre><code class="language-javascript">class Subject {
  observers = []
  add(observer) {
    this.observers.push(observer)
  }
  notify(...args) {
    this.observers.forEach(observer =&gt; observer.update(...args))
  }
}

class Observer {
  update(...args) {
    console.log(...args)
  }
}

const ob1 = new Observer(), ob2 = new Observer(), sub = new Subject()

sub.add(ob1)
sub.add(ob2)

sub.notify(&#x27;I fired `SMS` event&#x27;)
</code></pre>
<h2>发布订阅模式</h2>
<p>24 种基本的设计模式中并没有发布订阅模式，它只是观察者模式的一个别称</p>
<p>但是经过时间的沉淀，似乎他已经强大了起来，已经独立于观察者模式，成为另外一种不同的设计模式</p>
<p>现在的发布订阅模式中，发送者不会将消息直接发送给订阅者，而是通过调度中心或事件通道，它维持着发布者和订阅者之间的联系</p>
<ul>
<li>在微博上关注了A，那么当A发布动态的时候，微博就会为你推送这条动态</li>
<li>一个用户订阅了某个公众号，那么便会收到公众号发来的消息</li>
</ul>
<p>微博和微信平台则是调度中心，维持着发送者和订阅者之间的联系</p>
<p>EventEmitter 是一个典型的事件调度中心，</p>
<pre><code class="language-javascript">class EventEmitter {

  listeners = new Map()

  on(event, handler) {
    if (this.listeners.has(event)) {
      this.listeners.get(event).push(handler)
    } else {
      this.listeners.set(event, [handler])
    }
  }

  emit(event, ...args) {
    const listeners = this.listeners.get(event)
    if (listeners) {
      listeners.forEach(listener =&gt; listener(...args))
    }
  }
}
</code></pre>
<h2>区别</h2>
<p>角色数量：</p>
<ol>
<li>订阅发布模式需要三种角色，发布者、事件中心和订阅者</li>
<li>二观察者模式需要两种角色，目标和观察者</li>
</ol>
<p>耦合度：</p>
<ol>
<li>订阅发布模式是一个事件中心调度模式，订阅者和发布者是没有直接关联的，通过事件中心进行关联，两者是<strong>解耦</strong>的</li>
<li>观察者模式中目标和观察者是直接关联的，<strong>耦合在一起</strong></li>
</ol><div><a href="/notes/%E6%A8%A1%E5%BC%8F">cd ..</a></div></div></main><footer class="pb-2 pt-12 text-center shrink-0"><div class="capitalize">copyright <span class="text-2xl align-middle">©</span> <!-- -->2022<!-- --> xie feng</div><div class="text-sm">Powered by NextJS</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metaTitle":"发布订阅、观察者","article":{"title":"发布订阅、观察者","content":"## 观察者模式\n\n观察者模式定义了对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知并自动更新。\n\n观察者模式属于行为型模式，行为型模式关注的是对象之间的通讯，观察者模式就是观察者和被观察者之间的通讯\n\n观察者模式又叫做发布-订阅（Publish/Subscribe）模式，订阅者和订阅目标是联系在一起的，当订阅目标发生改变时，逐个通知订阅者\n\n- 气象站可以将每天预测到的温度、湿度、气压等以公告的形式发布给各种第三方网站\n- MVC 模式中的模型与视图的关系也属于观察与被观察\n\n```javascript\nclass Subject {\n  observers = []\n  add(observer) {\n    this.observers.push(observer)\n  }\n  notify(...args) {\n    this.observers.forEach(observer =\u003e observer.update(...args))\n  }\n}\n\nclass Observer {\n  update(...args) {\n    console.log(...args)\n  }\n}\n\nconst ob1 = new Observer(), ob2 = new Observer(), sub = new Subject()\n\nsub.add(ob1)\nsub.add(ob2)\n\nsub.notify('I fired `SMS` event')\n```\n\n## 发布订阅模式\n\n24 种基本的设计模式中并没有发布订阅模式，它只是观察者模式的一个别称\n\n但是经过时间的沉淀，似乎他已经强大了起来，已经独立于观察者模式，成为另外一种不同的设计模式\n\n现在的发布订阅模式中，发送者不会将消息直接发送给订阅者，而是通过调度中心或事件通道，它维持着发布者和订阅者之间的联系\n\n- 在微博上关注了A，那么当A发布动态的时候，微博就会为你推送这条动态\n- 一个用户订阅了某个公众号，那么便会收到公众号发来的消息\n\n微博和微信平台则是调度中心，维持着发送者和订阅者之间的联系\n\nEventEmitter 是一个典型的事件调度中心，\n\n```javascript\nclass EventEmitter {\n\n  listeners = new Map()\n\n  on(event, handler) {\n    if (this.listeners.has(event)) {\n      this.listeners.get(event).push(handler)\n    } else {\n      this.listeners.set(event, [handler])\n    }\n  }\n\n  emit(event, ...args) {\n    const listeners = this.listeners.get(event)\n    if (listeners) {\n      listeners.forEach(listener =\u003e listener(...args))\n    }\n  }\n}\n```\n\n## 区别\n\n角色数量：\n\n1. 订阅发布模式需要三种角色，发布者、事件中心和订阅者\n2. 二观察者模式需要两种角色，目标和观察者\n\n耦合度：\n\n1. 订阅发布模式是一个事件中心调度模式，订阅者和发布者是没有直接关联的，通过事件中心进行关联，两者是**解耦**的\n2. 观察者模式中目标和观察者是直接关联的，**耦合在一起**\n\n","meta":{"size":2695,"birthTime":1663496641431.726,"updateTime":1663496641431.9287}}},"__N_SSG":true},"page":"/notes/[[...param]]","query":{"param":["模式","发布订阅、观察者"]},"buildId":"OyucwIrXZRgWNxoAUA9lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>