<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>rust fight | 0X1461A0</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/5db4aa1edde4971b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5db4aa1edde4971b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c642bc88044b6e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c642bc88044b6e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-325eacbb81921a43.js" defer=""></script><script src="/_next/static/chunks/main-c87967b003e3efc2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-111c29f79e705983.js" defer=""></script><script src="/_next/static/chunks/542-e750f8bef0aa06d2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B%5B...param%5D%5D-4c9f87d1f418ba6e.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_buildManifest.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="pb-10 pt-12 text-center shrink-0"><a class="uppercase tracking-widest text-gray-600" href="/">0x1461a0</a></header><main class="flex-auto mb-12"><div class="TOC_table-of-content__KyR_J"><ul><li><a href="#move语义" data-target-id="h2-move语义-0">move语义</a></li></ul></div><div class="article_article-container__yUBmR"><div class="mb-8"><h1 data-title="true" class="mb-0">rust fight</h1><p class="opacity-50 !-mt-2"><span>Post: <!-- -->2022.09.18</span><span class="font-bold">·</span><span>Update: <!-- -->2022.09.18</span></p></div><h2>move语义</h2>
<p>通过引用不可以移动所有权，编译器会报这样的错误：</p>
<ol>
<li><code>cannot move out of op.next which is behind a shared reference </code></li>
<li><code>cannot move out of op.next which is behind a mutable reference</code></li>
</ol>
<pre><code class="language-rust">struct IterMut&lt;&#x27;a&gt; {
  next: Option&lt;&amp;&#x27;a mut i32&gt;,
}

let mut a = 1;

let op = &amp;IterMut { next: Some(&amp;mut a) };
// let op = &amp;mut Demo { next: Some(&amp;mut a) };

let b = op.next;

b.map(|x| *x);
</code></pre>
<p>对于 <code>Option</code> 的可变引用，可以使用 <code>take</code> 解决</p>
<pre><code class="language-rust">let b = op.next.take();

b.map(|x| *x);
</code></pre><div><a href="/notes">cd ..</a></div></div></main><footer class="pb-2 pt-12 text-center shrink-0"><div class="capitalize">copyright <span class="text-2xl align-middle">©</span> <!-- -->2022<!-- --> xie feng</div><div class="text-sm">Powered by NextJS</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metaTitle":"rust fight","article":{"title":"rust fight","content":"## move语义\n\n通过引用不可以移动所有权，编译器会报这样的错误：\n\n1. `cannot move out of op.next which is behind a shared reference ` \n2. `cannot move out of op.next which is behind a mutable reference` \n\n```rust\nstruct IterMut\u003c'a\u003e {\n  next: Option\u003c\u0026'a mut i32\u003e,\n}\n\nlet mut a = 1;\n\nlet op = \u0026IterMut { next: Some(\u0026mut a) };\n// let op = \u0026mut Demo { next: Some(\u0026mut a) };\n\nlet b = op.next;\n\nb.map(|x| *x);\n```\n\n对于 `Option` 的可变引用，可以使用 `take` 解决\n\n```rust\nlet b = op.next.take();\n\nb.map(|x| *x);\n```\n\n\n\n","meta":{"size":549,"birthTime":1663496641422.6108,"updateTime":1663496641422.7961}}},"__N_SSG":true},"page":"/notes/[[...param]]","query":{"param":["rust fight"]},"buildId":"OyucwIrXZRgWNxoAUA9lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>