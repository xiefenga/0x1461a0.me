<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>存储过程和函数 | 0X1461A0</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/5db4aa1edde4971b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5db4aa1edde4971b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c642bc88044b6e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c642bc88044b6e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-325eacbb81921a43.js" defer=""></script><script src="/_next/static/chunks/main-c87967b003e3efc2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-111c29f79e705983.js" defer=""></script><script src="/_next/static/chunks/542-e750f8bef0aa06d2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B%5B...param%5D%5D-4c9f87d1f418ba6e.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_buildManifest.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="pb-10 pt-12 text-center shrink-0"><a class="uppercase tracking-widest text-gray-600" href="/">0x1461a0</a></header><main class="flex-auto mb-12"><div class="TOC_table-of-content__KyR_J"><ul><li><a href="#存储过程" data-target-id="h1-存储过程-0">存储过程</a><ul><li><a href="#创建" data-target-id="h2-创建-0">创建</a></li><li><a href="#其他操作" data-target-id="h2-其他操作-1">其他操作</a></li><li><a href="#分隔符" data-target-id="h2-分隔符-2">分隔符</a></li><li><a href="#参数" data-target-id="h2-参数-3">参数</a></li></ul></li><li><a href="#函数" data-target-id="h1-函数-1">函数</a><ul><li><a href="#创建" data-target-id="h2-创建-4">创建</a></li><li><a href="#其他操作" data-target-id="h2-其他操作-5">其他操作</a></li><li><a href="#参数" data-target-id="h2-参数-6">参数</a></li><li><a href="#1418错误" data-target-id="h2-1418错误-7">1418错误</a></li></ul></li><li><a href="#变量" data-target-id="h1-变量-2">变量</a><ul><li><a href="#系统变量" data-target-id="h2-系统变量-8">系统变量</a><ul><li><a href="#查看所有" data-target-id="h3-查看所有-0">查看所有</a></li><li><a href="#查看部分" data-target-id="h3-查看部分-1">查看部分</a></li><li><a href="#查看指定" data-target-id="h3-查看指定-2">查看指定</a></li><li><a href="#赋值" data-target-id="h3-赋值-3">赋值</a></li></ul></li><li><a href="#自定义变量" data-target-id="h2-自定义变量-9">自定义变量</a><ul><li><a href="#声明" data-target-id="h3-声明-4">声明</a></li><li><a href="#赋值" data-target-id="h3-赋值-5">赋值</a></li><li><a href="#使用" data-target-id="h3-使用-6">使用</a></li></ul></li></ul></li><li><a href="#流程控制" data-target-id="h1-流程控制-3">流程控制</a><ul><li><a href="#分支结构" data-target-id="h2-分支结构-10">分支结构</a><ul><li><a href="#IF函数" data-target-id="h3-IF函数-7">IF函数</a></li><li><a href="#CASE语句" data-target-id="h3-CASE语句-8">CASE语句</a></li><li><a href="#IF语句" data-target-id="h3-IF语句-9">IF语句</a></li></ul></li><li><a href="#循环结构" data-target-id="h2-循环结构-11">循环结构</a><ul><li><a href="#WHILE" data-target-id="h3-WHILE-10">WHILE</a></li><li><a href="#LOOP" data-target-id="h3-LOOP-11">LOOP</a></li><li><a href="#REPEAT" data-target-id="h3-REPEAT-12">REPEAT</a></li></ul></li></ul></li></ul></div><div class="article_article-container__yUBmR"><div class="mb-8"><h1 data-title="true" class="mb-0">存储过程和函数</h1><p class="opacity-50 !-mt-2"><span>Post: <!-- -->2022.09.18</span><span class="font-bold">·</span><span>Update: <!-- -->2022.09.18</span></p></div><h1>存储过程</h1>
<p>事先经过编译并存储在数据库中的一段 SQL 语句的集合。</p>
<h2>创建</h2>
<pre><code class="language-mysql">CREATE PROCEDURE myprocedure ()
BEGIN
	SELECT
		avg( prod_price ) AS priceaverage 
	FROM
	products;
END;
</code></pre>
<h2>其他操作</h2>
<p><strong>调用</strong></p>
<pre><code class="language-mysql">CALL myprocedure();
</code></pre>
<p><strong>删除</strong></p>
<pre><code class="language-mysql">DROP PROCEDURE [IF EXISTS] myprocedure;
</code></pre>
<p><strong>查看</strong></p>
<pre><code class="language-mysql">SHOW CREATE PROCEDURE test;
</code></pre>
<h2>分隔符</h2>
<p>由于 MySQL 语句默认的分隔符和 MySQL 命令行实用程序的语句分隔符都是 <code>;</code></p>
<p>当通过命令行使用 MySQL 时，需要使用 <code>DELIMITER</code> 临时更改命令行默认的分隔符</p>
<pre><code class="language-shell">mysql&gt; delimiter $
mysql&gt; CREATE PROCEDURE test()
    -&gt; begin
    -&gt; SELECT
    -&gt;          avg( prod_price ) AS priceaverage
    -&gt;  FROM
    -&gt;  products;
    -&gt; end$
Query OK, 0 rows affected (0.39 sec)

mysql&gt; call test()$
+--------------+
| priceaverage |
+--------------+
|    16.133571 |
+--------------+
1 row in set (0.21 sec)

Query OK, 0 rows affected (0.21 sec)
</code></pre>
<h2>参数</h2>
<p>参数列表包含三部分：参数模式、参数名、参数类型</p>
<p>参数模式：</p>
<ul>
<li><code>IN</code>：该参数可以作为输入，该参数为传入的形参</li>
<li><code>OUT</code>：该参数可以作为输出，也就是该参数就是返回值</li>
<li><code>INOUT</code>：该参数既可以作为输入又可以作为输出，该参数既是传入的值，也是返回值</li>
</ul>
<pre><code class="language-mysql">CREATE PROCEDURE ordertotal (
	IN onumber INT,
	OUT ototal DECIMAL( 8, 2 )
)
BEGIN
	SELECT
		SUM( item_price * quantity ) 
	FROM
		orderitems 
	WHERE
	order_num = onumber INTO ototal;
END;
</code></pre>
<p>调用时可以直接定义并使用变量，不需要预先定义再使用：</p>
<pre><code class="language-mysql">CALL ordertotal ( 20005, @total );
SELECT @total;
+--------+
| @total |
+--------+
| 149.87 |
+--------+
</code></pre>
<h1>函数</h1>
<p>和存储过程一样都是事先经过编译并存储在数据库中的一段 SQL 语句的集合。</p>
<h2>创建</h2>
<pre><code class="language-mysql">CREATE FUNCTION employeeNum() RETURNS INT
BEGIN
	DECLARE num INT DEFAULT 0; -- 定义局部变量
	SELECT
		COUNT(*) INTO num -- 赋值操作
	FROM
		employees;
	RETURN num;	-- 返回
END;
</code></pre>
<h2>其他操作</h2>
<p><strong>调用</strong></p>
<pre><code class="language-mysql">SELECT employeeNum() AS num;
</code></pre>
<p><strong>删除</strong></p>
<pre><code class="language-mysql">DROP FUNCTION employeeNum;
</code></pre>
<p><strong>查看</strong></p>
<pre><code class="language-mysql">SHOW CREATE FUNCTION employeeNum;
</code></pre>
<h2>参数</h2>
<p>参数列表包含两部分：参数名、参数类型</p>
<p>函数必须要有 <code>RETURN</code> 语句，如果没有会报错，<code>RETURN</code> 语句可以不放在最后。</p>
<pre><code class="language-mysql">CREATE FUNCTION employeeSalary (`name` VARCHAR ( 20 )) RETURNS DOUBLE
BEGIN
	SET @sal = 0;
	SELECT
		salary INTO @sal
	FROM
		employees 
	WHERE
		last_name = `name`;
	RETURN @sal;
END;
</code></pre>
<h2>1418错误</h2>
<p>在创建函数时可能会出现这样的错误：</p>
<blockquote>
<p>ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you <em>might</em> want to use the less safe log_bin_trust_function_creators variable)</p>
</blockquote>
<p>这是我们开启了 bin-log, 我们必须指定该函数是否是：</p>
<ul>
<li>DETERMINISTIC</li>
<li>NO SQL</li>
<li>READS SQL DATA</li>
<li>MODIFIES SQL DATA</li>
<li>CONTAINS SQL</li>
</ul>
<p>在函数中只有 DETERMINISTIC, NO SQL 和 READS SQL DATA 被支持。</p>
<p>如果我们开启了 bin-log，我们就必须为我们的函数指定一个参数。</p>
<p>或者：</p>
<pre><code class="language-mysql">SET GLOBAL log_bin_trust_function_creators = TRUE;
</code></pre>
<h1>变量</h1>
<ul>
<li>系统变量<!-- -->
<ul>
<li>全局变量</li>
<li>会话变量</li>
</ul>
</li>
<li>自定义变量<!-- -->
<ul>
<li>用户变量</li>
<li>局部变量</li>
</ul>
</li>
</ul>
<h2>系统变量</h2>
<p>系统变量由系统定义，不是用户定义，属于服务器层面。</p>
<p>根据级别分为全局变量和会话变量，在操作时分别需要使用关键字 <code>GLOBAL</code> 和 <code>SESSION</code>，省略默认为会话级别。</p>
<h3>查看所有</h3>
<pre><code class="language-mysql">SHOW GLOBAL VARIABLES;
SHOW [SESSION] VARIABLES;
</code></pre>
<h3>查看部分</h3>
<pre><code class="language-mysql">SHOW GLOBAL VARIABLES LIKE &#x27;%char%&#x27;;
</code></pre>
<h3>查看指定</h3>
<pre><code class="language-mysql">SELECT @@GLOBAL.character_set_client;
</code></pre>
<p>当省略 <code>SESSION</code> 时查看变量：</p>
<pre><code class="language-mysql">SELECT @@autocommit;
</code></pre>
<h3>赋值</h3>
<pre><code class="language-mysql">SET @@GLOBAL.autocommit = 0;

SET GLOBAL autocommit = 0;
</code></pre>
<h2>自定义变量</h2>
<p>自定义变量由用户自定义，而不是系统提供的。</p>
<p>根据作用域分为：用户变量和局部变量。</p>
<ul>
<li>用户变量在当前会话全局有效，等同于会话变量</li>
<li>局部变量仅仅在定义它的 <code>BEGIN</code> 和 <code>END</code> 块中有效，也只能定义在 <code>BEGIN</code> 和 <code>END</code> 块中开始</li>
<li>变量都是以 <code>@</code> 开始</li>
</ul>
<h3>声明</h3>
<p>用户变量的声明和赋值语法相同，也就是声明时就需要初始化。</p>
<p>局部变量只能定义在 <code>BEGIN</code> 和 <code>END</code> 块头部，而且如果没有初始化则默认值为 <code>NULL</code></p>
<p><strong>用户变量</strong></p>
<pre><code class="language-mysql">SET @val1 = &#x27;val1&#x27;;
SET @val2 := &#x27;val2&#x27;;
SELECT @val3 := &#x27;val3&#x27;;
</code></pre>
<p><strong>局部变量</strong></p>
<pre><code class="language-mysql">DECLARE @val1 VARCHAR(20);
DECLARE @val2 VARCHAR(20) DEFAULT &#x27;val2&#x27;;
</code></pre>
<h3>赋值</h3>
<pre><code class="language-mysql">SET @val1 = &#x27;val&#x27;;
SET @val2 := &#x27;val&#x27;;
SELECT @val3 := &#x27;val&#x27;;
</code></pre>
<p><strong>查询赋值</strong></p>
<pre><code class="language-mysql">SET @num = 0;
SELECT COUNT(*) INTO @num FROM employees;
-- 或者
SELECT COUNT(*) FROM employees INTO @num;
</code></pre>
<p>两种方式都能完成赋值，区别是：</p>
<ul>
<li><code>INTO</code> 放在前面查询结果直接赋值给变量，没有查询结果</li>
<li><code>INTO</code> 放在后面，既有查询结果也成功赋值</li>
</ul>
<h3>使用</h3>
<pre><code class="language-mysql">SELECT @val;
</code></pre>
<h1>流程控制</h1>
<h2>分支结构</h2>
<h3>IF函数</h3>
<p>和三元表达式类似，三个参数可以都是表达式，可以用在任何地方</p>
<pre><code class="language-mysql">SELECT IF(1, 2, 3);
</code></pre>
<h3>CASE语句</h3>
<p>不仅可以用在 <code>BEGIN</code> 和 <code>END</code> 块中，还可以用户  <code>BEGIN</code> 和 <code>END</code> 块外</p>
<pre><code class="language-mysql">SELECT salary AS 原始工资, department_id,
	CASE department_id 
		WHEN 30 THEN salary * 1.1 
		WHEN 40 THEN salary * 1.2 
		WHEN 50 THEN salary * 1.3
		ELSE salary 
	END AS 新工资 
FROM
	employees;
</code></pre>
<h3>IF语句</h3>
<p>只能应用在 <code>BEGIN</code> 和 <code>END</code> 块中</p>
<pre><code class="language-mysql">CREATE FUNCTION test_if(score FLOAT) RETURNS CHAR
BEGIN
	DECLARE ch CHAR DEFAULT &#x27;A&#x27;;
	IF 		score&gt;90 	THEN SET ch=&#x27;A&#x27;;
	ELSEIF 	score&gt;80 	THEN SET ch=&#x27;B&#x27;;
	ELSEIF 	score&gt;60 	THEN SET ch=&#x27;C&#x27;;
	ELSE SET ch=&#x27;D&#x27;;
	END IF;
	RETURN ch;
END;
</code></pre>
<h2>循环结构</h2>
<p>每一种循环前都可以添加一个标签，方便在循环体内跳出。</p>
<ul>
<li><code>ITERATE</code>：类似于 <code>continue</code>，后面需要加 label</li>
<li><code>LEAVE</code>：类似于 <code>break</code>，后面需要加 label</li>
</ul>
<h3>WHILE</h3>
<pre><code class="language-mysql">[label:] WHILE search_condition DO
	statement_list
END WHILE [label];
</code></pre>
<h3>LOOP</h3>
<pre><code class="language-mysql">[label: ]LOOP
	statement_list
	IF exit_condition THEN LEAVE label; 
	END IF; 
END LOOP [label];
</code></pre>
<h3>REPEAT</h3>
<pre><code class="language-mysql">[label:] REPEAT
	statement_list
UNTIL search_condition
END REPEAT [label];
</code></pre><div><a href="/notes/MySQL">cd ..</a></div></div></main><footer class="pb-2 pt-12 text-center shrink-0"><div class="capitalize">copyright <span class="text-2xl align-middle">©</span> <!-- -->2022<!-- --> xie feng</div><div class="text-sm">Powered by NextJS</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metaTitle":"存储过程和函数","article":{"title":"存储过程和函数","content":"# 存储过程\r\n\r\n事先经过编译并存储在数据库中的一段 SQL 语句的集合。\r\n\r\n## 创建\r\n\r\n```mysql\r\nCREATE PROCEDURE myprocedure ()\r\nBEGIN\r\n\tSELECT\r\n\t\tavg( prod_price ) AS priceaverage \r\n\tFROM\r\n\tproducts;\r\nEND;\r\n```\r\n\r\n## 其他操作\r\n\r\n**调用**\r\n\r\n```mysql\r\nCALL myprocedure();\r\n```\r\n\r\n**删除**\r\n\r\n```mysql\r\nDROP PROCEDURE [IF EXISTS] myprocedure;\r\n```\r\n\r\n**查看**\r\n\r\n```mysql\r\nSHOW CREATE PROCEDURE test;\r\n```\r\n\r\n## 分隔符\r\n\r\n由于 MySQL 语句默认的分隔符和 MySQL 命令行实用程序的语句分隔符都是 `;`\r\n\r\n当通过命令行使用 MySQL 时，需要使用 `DELIMITER` 临时更改命令行默认的分隔符\r\n\r\n```shell\r\nmysql\u003e delimiter $\r\nmysql\u003e CREATE PROCEDURE test()\r\n    -\u003e begin\r\n    -\u003e SELECT\r\n    -\u003e          avg( prod_price ) AS priceaverage\r\n    -\u003e  FROM\r\n    -\u003e  products;\r\n    -\u003e end$\r\nQuery OK, 0 rows affected (0.39 sec)\r\n\r\nmysql\u003e call test()$\r\n+--------------+\r\n| priceaverage |\r\n+--------------+\r\n|    16.133571 |\r\n+--------------+\r\n1 row in set (0.21 sec)\r\n\r\nQuery OK, 0 rows affected (0.21 sec)\r\n```\r\n\r\n## 参数\r\n\r\n参数列表包含三部分：参数模式、参数名、参数类型\r\n\r\n参数模式：\r\n\r\n- `IN`：该参数可以作为输入，该参数为传入的形参\r\n- `OUT`：该参数可以作为输出，也就是该参数就是返回值\r\n- `INOUT`：该参数既可以作为输入又可以作为输出，该参数既是传入的值，也是返回值\r\n\r\n```mysql\r\nCREATE PROCEDURE ordertotal (\r\n\tIN onumber INT,\r\n\tOUT ototal DECIMAL( 8, 2 )\r\n)\r\nBEGIN\r\n\tSELECT\r\n\t\tSUM( item_price * quantity ) \r\n\tFROM\r\n\t\torderitems \r\n\tWHERE\r\n\torder_num = onumber INTO ototal;\r\nEND;\r\n```\r\n\r\n调用时可以直接定义并使用变量，不需要预先定义再使用：\r\n\r\n```mysql\r\nCALL ordertotal ( 20005, @total );\r\nSELECT @total;\r\n+--------+\r\n| @total |\r\n+--------+\r\n| 149.87 |\r\n+--------+\r\n```\r\n\r\n# 函数\r\n\r\n和存储过程一样都是事先经过编译并存储在数据库中的一段 SQL 语句的集合。\r\n\r\n## 创建\r\n\r\n```mysql\r\nCREATE FUNCTION employeeNum() RETURNS INT\r\nBEGIN\r\n\tDECLARE num INT DEFAULT 0; -- 定义局部变量\r\n\tSELECT\r\n\t\tCOUNT(*) INTO num -- 赋值操作\r\n\tFROM\r\n\t\temployees;\r\n\tRETURN num;\t-- 返回\r\nEND;\r\n```\r\n\r\n## 其他操作\r\n\r\n**调用**\r\n\r\n```mysql\r\nSELECT employeeNum() AS num;\r\n```\r\n\r\n**删除**\r\n\r\n```mysql\r\nDROP FUNCTION employeeNum;\r\n```\r\n\r\n**查看**\r\n\r\n```mysql\r\nSHOW CREATE FUNCTION employeeNum;\r\n```\r\n\r\n## 参数\r\n\r\n参数列表包含两部分：参数名、参数类型\r\n\r\n函数必须要有 `RETURN` 语句，如果没有会报错，`RETURN` 语句可以不放在最后。\r\n\r\n```mysql\r\nCREATE FUNCTION employeeSalary (`name` VARCHAR ( 20 )) RETURNS DOUBLE\r\nBEGIN\r\n\tSET @sal = 0;\r\n\tSELECT\r\n\t\tsalary INTO @sal\r\n\tFROM\r\n\t\temployees \r\n\tWHERE\r\n\t\tlast_name = `name`;\r\n\tRETURN @sal;\r\nEND;\r\n```\r\n\r\n## 1418错误\r\n\r\n在创建函数时可能会出现这样的错误：\r\n\r\n\u003e ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)\r\n\r\n这是我们开启了 bin-log, 我们必须指定该函数是否是：\r\n\r\n- DETERMINISTIC \r\n- NO SQL\r\n- READS SQL DATA\r\n- MODIFIES SQL DATA\r\n- CONTAINS SQL\r\n\r\n在函数中只有 DETERMINISTIC, NO SQL 和 READS SQL DATA 被支持。\r\n\r\n如果我们开启了 bin-log，我们就必须为我们的函数指定一个参数。\r\n\r\n或者：\r\n\r\n```mysql\r\nSET GLOBAL log_bin_trust_function_creators = TRUE;\r\n```\r\n\r\n# 变量\r\n\r\n- 系统变量\r\n\t- 全局变量\r\n\t- 会话变量\r\n- 自定义变量\r\n\t- 用户变量\r\n\t- 局部变量\r\n\r\n## 系统变量\r\n\r\n系统变量由系统定义，不是用户定义，属于服务器层面。\r\n\r\n根据级别分为全局变量和会话变量，在操作时分别需要使用关键字 `GLOBAL` 和 `SESSION`，省略默认为会话级别。\r\n\r\n### 查看所有\r\n\r\n```mysql\r\nSHOW GLOBAL VARIABLES;\r\nSHOW [SESSION] VARIABLES;\r\n```\r\n\r\n### 查看部分\r\n\r\n```mysql\r\nSHOW GLOBAL VARIABLES LIKE '%char%';\r\n```\r\n\r\n### 查看指定\r\n\r\n```mysql\r\nSELECT @@GLOBAL.character_set_client;\r\n```\r\n\r\n当省略 `SESSION` 时查看变量：\r\n\r\n```mysql\r\nSELECT @@autocommit;\r\n```\r\n\r\n### 赋值\r\n\r\n```mysql\r\nSET @@GLOBAL.autocommit = 0;\r\n\r\nSET GLOBAL autocommit = 0;\r\n```\r\n\r\n## 自定义变量\r\n\r\n自定义变量由用户自定义，而不是系统提供的。\r\n\r\n根据作用域分为：用户变量和局部变量。\r\n\r\n- 用户变量在当前会话全局有效，等同于会话变量\r\n- 局部变量仅仅在定义它的 `BEGIN` 和 `END` 块中有效，也只能定义在 `BEGIN` 和 `END` 块中开始\r\n- 变量都是以 `@` 开始\r\n\r\n### 声明\r\n\r\n用户变量的声明和赋值语法相同，也就是声明时就需要初始化。\r\n\r\n局部变量只能定义在 `BEGIN` 和 `END` 块头部，而且如果没有初始化则默认值为 `NULL`\r\n\r\n**用户变量**\r\n\r\n```mysql\r\nSET @val1 = 'val1';\r\nSET @val2 := 'val2';\r\nSELECT @val3 := 'val3';\r\n```\r\n\r\n**局部变量**\r\n\r\n```mysql\r\nDECLARE @val1 VARCHAR(20);\r\nDECLARE @val2 VARCHAR(20) DEFAULT 'val2';\r\n```\r\n\r\n### 赋值\r\n\r\n```mysql\r\nSET @val1 = 'val';\r\nSET @val2 := 'val';\r\nSELECT @val3 := 'val';\r\n```\r\n\r\n**查询赋值**\r\n\r\n```mysql\r\nSET @num = 0;\r\nSELECT COUNT(*) INTO @num FROM employees;\r\n-- 或者\r\nSELECT COUNT(*) FROM employees INTO @num;\r\n```\r\n\r\n两种方式都能完成赋值，区别是：\r\n\r\n- `INTO` 放在前面查询结果直接赋值给变量，没有查询结果\r\n- `INTO` 放在后面，既有查询结果也成功赋值\r\n\r\n### 使用\r\n\r\n```mysql\r\nSELECT @val;\r\n```\r\n\r\n# 流程控制\r\n\r\n## 分支结构\r\n\r\n### IF函数\r\n\r\n和三元表达式类似，三个参数可以都是表达式，可以用在任何地方\r\n\r\n```mysql\r\nSELECT IF(1, 2, 3);\r\n```\r\n\r\n### CASE语句\r\n\r\n不仅可以用在 `BEGIN` 和 `END` 块中，还可以用户  `BEGIN` 和 `END` 块外\r\n\r\n```mysql\r\nSELECT salary AS 原始工资, department_id,\r\n\tCASE department_id \r\n\t\tWHEN 30 THEN salary * 1.1 \r\n\t\tWHEN 40 THEN salary * 1.2 \r\n\t\tWHEN 50 THEN salary * 1.3\r\n\t\tELSE salary \r\n\tEND AS 新工资 \r\nFROM\r\n\temployees;\r\n```\r\n\r\n### IF语句\r\n\r\n只能应用在 `BEGIN` 和 `END` 块中\r\n\r\n```mysql\r\nCREATE FUNCTION test_if(score FLOAT) RETURNS CHAR\r\nBEGIN\r\n\tDECLARE ch CHAR DEFAULT 'A';\r\n\tIF \t\tscore\u003e90 \tTHEN SET ch='A';\r\n\tELSEIF \tscore\u003e80 \tTHEN SET ch='B';\r\n\tELSEIF \tscore\u003e60 \tTHEN SET ch='C';\r\n\tELSE SET ch='D';\r\n\tEND IF;\r\n\tRETURN ch;\r\nEND;\r\n```\r\n\r\n## 循环结构\r\n\r\n每一种循环前都可以添加一个标签，方便在循环体内跳出。\r\n\r\n- `ITERATE`：类似于 `continue`，后面需要加 label\r\n- `LEAVE`：类似于 `break`，后面需要加 label\r\n\r\n### WHILE\r\n\r\n```mysql\r\n[label:] WHILE search_condition DO\r\n\tstatement_list\r\nEND WHILE [label];\r\n```\r\n\r\n### LOOP\r\n\r\n```mysql\r\n[label: ]LOOP\r\n\tstatement_list\r\n\tIF exit_condition THEN LEAVE label; \r\n\tEND IF; \r\nEND LOOP [label];\r\n```\r\n\r\n### REPEAT\r\n\r\n```mysql\r\n[label:] REPEAT\r\n\tstatement_list\r\nUNTIL search_condition\r\nEND REPEAT [label];\r\n```\r\n\r\n\r\n\r\n","meta":{"size":6954,"birthTime":1663496641412.5667,"updateTime":1663496641412.672}}},"__N_SSG":true},"page":"/notes/[[...param]]","query":{"param":["MySQL","存储过程和函数"]},"buildId":"OyucwIrXZRgWNxoAUA9lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>