<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>express中间件 | 0X1461A0</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/5db4aa1edde4971b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5db4aa1edde4971b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c642bc88044b6e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c642bc88044b6e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-325eacbb81921a43.js" defer=""></script><script src="/_next/static/chunks/main-c87967b003e3efc2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-111c29f79e705983.js" defer=""></script><script src="/_next/static/chunks/542-e750f8bef0aa06d2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B%5B...param%5D%5D-4c9f87d1f418ba6e.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_buildManifest.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="pb-10 pt-12 text-center shrink-0"><a class="uppercase tracking-widest text-gray-600" href="/">0x1461a0</a></header><main class="flex-auto mb-12"><div class="TOC_table-of-content__KyR_J"><ul><li><a href="#中间件" data-target-id="h1-中间件-0">中间件</a></li><li><a href="#中间件处理的细节" data-target-id="h1-中间件处理的细节-1">中间件处理的细节</a></li></ul></div><div class="article_article-container__yUBmR"><div class="mb-8"><h1 data-title="true" class="mb-0">express中间件</h1><p class="opacity-50 !-mt-2"><span>Post: <!-- -->2022.09.18</span><span class="font-bold">·</span><span>Update: <!-- -->2022.09.18</span></p></div><h1>中间件</h1>
<p>中间件函数能够访问请求对象 (<code>req</code>)、响应对象 (<code>res</code>) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 <code>next</code> 的变量来表示。简单来说就是请求的回调函数，该函数最多有四个参数，并且该函数可以有多个，可以接力处理。</p>
<pre><code class="language-js">const express = require(&#x27;express&#x27;);

const app = express();

app.get(
    &#x27;/&#x27;,
    (req, res, next) =&gt; {
        console.log(&#x27;第一个中间件函数&#x27;);
        next();
    },
    (req, res, next) =&gt; {
        console.log(&#x27;第二个中间件函数&#x27;);
        next();
    },
    (req, res, next) =&gt; {
        console.log(&#x27;最后一个中间件&#x27;);
        res.send(&#x27;hello world&#x27;);
    }
);

app.listen(12306, () =&gt; console.log(&#x27;serve is running on 12306&#x27;));
</code></pre>
<h1>中间件处理的细节</h1>
<ol>
<li>后续没有中间件但是调用了 <code>next()</code>，如果前面的中间件已经响应没事否则express 会返回 404</li>
</ol>
<pre><code class="language-js">app.get(
    &#x27;/&#x27;,
    (req, res, next) =&gt; {
        console.log(&#x27;第一个中间件函数&#x27;);
        next();
    },
    (req, res, next) =&gt; {
        console.log(&#x27;第一个中间件函数&#x27;);
        next();
    },
    (req, res, next) =&gt; {
        console.log(&#x27;最后一个中间件&#x27;);
        next();
    }
);
</code></pre>
<ol start="2">
<li>调用 <code>next()</code> 的时候传参，那么参数就是下一个中间件的错误参数（参数的类型未必是 error）</li>
</ol>
<pre><code class="language-js">app.get(
    &#x27;/&#x27;,
    (req, res, next) =&gt; {
        console.log(&#x27;didi&#x27;);
        next(&#x27;dada&#x27;);
    },
    (err, req, res, next) =&gt; {
        console.log(err);
        res.end(&#x27;hello world&#x27;);
    }
);
</code></pre>
<p>如果后续(不一定紧挨着)不接收该参数，也就是不处理该错误，express 会给客户端返回 500，并在控制台输出该错误参数</p>
<ol start="3">
<li>如果中间件发生了错误，和调用 <code>next(error)</code> 一样</li>
</ol>
<pre><code class="language-js">app.get(
    &#x27;/&#x27;,
    (req, res, next) =&gt; {
        console.log(&#x27;didi&#x27;);
       throw new Error(&#x27;dada&#x27;);
        next();
    },
    (err, req, res, next) =&gt; {
        console.log(err);
        res.end(&#x27;hello world&#x27;);
    }
);
</code></pre><div><a href="/notes/JavaScript">cd ..</a></div></div></main><footer class="pb-2 pt-12 text-center shrink-0"><div class="capitalize">copyright <span class="text-2xl align-middle">©</span> <!-- -->2022<!-- --> xie feng</div><div class="text-sm">Powered by NextJS</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metaTitle":"express中间件","article":{"title":"express中间件","content":"# 中间件\r\n\r\n中间件函数能够访问请求对象 (`req`)、响应对象 (`res`) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 `next` 的变量来表示。简单来说就是请求的回调函数，该函数最多有四个参数，并且该函数可以有多个，可以接力处理。\r\n\r\n```js\r\nconst express = require('express');\r\n\r\nconst app = express();\r\n\r\napp.get(\r\n    '/',\r\n    (req, res, next) =\u003e {\r\n        console.log('第一个中间件函数');\r\n        next();\r\n    },\r\n    (req, res, next) =\u003e {\r\n        console.log('第二个中间件函数');\r\n        next();\r\n    },\r\n    (req, res, next) =\u003e {\r\n        console.log('最后一个中间件');\r\n        res.send('hello world');\r\n    }\r\n);\r\n\r\napp.listen(12306, () =\u003e console.log('serve is running on 12306'));\r\n```\r\n\r\n# 中间件处理的细节\r\n\r\n1. 后续没有中间件但是调用了 `next()`，如果前面的中间件已经响应没事否则express 会返回 404\r\n\r\n```js\r\napp.get(\r\n    '/',\r\n    (req, res, next) =\u003e {\r\n        console.log('第一个中间件函数');\r\n        next();\r\n    },\r\n    (req, res, next) =\u003e {\r\n        console.log('第一个中间件函数');\r\n        next();\r\n    },\r\n    (req, res, next) =\u003e {\r\n        console.log('最后一个中间件');\r\n        next();\r\n    }\r\n);\r\n```\r\n\r\n2. 调用 `next()` 的时候传参，那么参数就是下一个中间件的错误参数（参数的类型未必是 error）\r\n\r\n```js\r\napp.get(\r\n    '/',\r\n    (req, res, next) =\u003e {\r\n        console.log('didi');\r\n        next('dada');\r\n    },\r\n    (err, req, res, next) =\u003e {\r\n        console.log(err);\r\n        res.end('hello world');\r\n    }\r\n);\r\n```\r\n\r\n如果后续(不一定紧挨着)不接收该参数，也就是不处理该错误，express 会给客户端返回 500，并在控制台输出该错误参数\r\n\r\n3. 如果中间件发生了错误，和调用 `next(error)` 一样\r\n\r\n```js\r\napp.get(\r\n    '/',\r\n    (req, res, next) =\u003e {\r\n        console.log('didi');\r\n       throw new Error('dada');\r\n        next();\r\n    },\r\n    (err, req, res, next) =\u003e {\r\n        console.log(err);\r\n        res.end('hello world');\r\n    }\r\n);\r\n```\r\n\r\n","meta":{"size":2180,"birthTime":1663496641403.3933,"updateTime":1663496641403.6123}}},"__N_SSG":true},"page":"/notes/[[...param]]","query":{"param":["JavaScript","express中间件"]},"buildId":"OyucwIrXZRgWNxoAUA9lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>