<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>事件 | 0X1461A0</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/5db4aa1edde4971b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5db4aa1edde4971b.css" data-n-g=""/><link rel="preload" href="/_next/static/css/38c642bc88044b6e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38c642bc88044b6e.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2c644d3580cecc35.js" defer=""></script><script src="/_next/static/chunks/framework-325eacbb81921a43.js" defer=""></script><script src="/_next/static/chunks/main-c87967b003e3efc2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-111c29f79e705983.js" defer=""></script><script src="/_next/static/chunks/542-e750f8bef0aa06d2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B%5B...param%5D%5D-4c9f87d1f418ba6e.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_buildManifest.js" defer=""></script><script src="/_next/static/OyucwIrXZRgWNxoAUA9lF/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><header class="pb-10 pt-12 text-center shrink-0"><a class="uppercase tracking-widest text-gray-600" href="/">0x1461a0</a></header><main class="flex-auto mb-12"><div class="TOC_table-of-content__KyR_J"><ul><li><a href="#移动端事件" data-target-id="h2-移动端事件-0">移动端事件</a></li><li><a href="#事件穿透" data-target-id="h2-事件穿透-1">事件穿透</a><ul><li><a href="#发生原因" data-target-id="h3-发生原因-0">发生原因</a></li><li><a href="#解决方法" data-target-id="h3-解决方法-1">解决方法</a></li></ul></li><li><a href="#阻止默认行为" data-target-id="h2-阻止默认行为-2">阻止默认行为</a></li><li><a href="#passive" data-target-id="h2-passive-3">passive</a></li></ul></div><div class="article_article-container__yUBmR"><div class="mb-8"><h1 data-title="true" class="mb-0">事件</h1><p class="opacity-50 !-mt-2"><span>Post: <!-- -->2022.09.18</span><span class="font-bold">·</span><span>Update: <!-- -->2022.09.18</span></p></div><h2>移动端事件</h2>
<p>移动端点击触发顺序：touchstart → touchend → mousedown → mouseup → click</p>
<p>当没有设置 <code>&lt;meta name=&quot;viewport&quot; /&gt;</code> 的时候</p>
<ol>
<li>单机 PC 端事件会延迟 300ms 触发</li>
<li>双击页面会进行缩放，且会触发两次 touchstart、touchend，不会触发 PC 端事件</li>
</ol>
<p><a href="changedTouches">changedTouches</a></p>
<h2>事件穿透</h2>
<p>在移动端中对于重叠元素，当最顶层元素触发 <code>touch</code> 事件之后并消失，下层元素会触发 <code>click</code> 事件</p>
<h3>发生原因</h3>
<p>移动端点击事件触发顺序：touchstart -&gt; touchend -&gt; click</p>
<p>click 事件的滞后性设计导致了上层元素隐藏之后，浏览器触发了 <em>click</em> 事件，但是此时上层元素不见了，所以该事件被派发到了下层元素身上</p>
<p>常见的事件穿透场景：</p>
<ul>
<li>目标元素触发触摸事件时隐藏或移除自身，对应位置元素触发 click 事件或 a 链接跳转</li>
<li>目标元素使用触摸事件跳转至新页面，新页面中对应位置元素触发 click 事件或 a 链接跳转</li>
</ul>
<h3>解决方法</h3>
<ul>
<li>阻止元素的默认行为，后续事件不再触发</li>
<li>全局阻止默认行为（document）</li>
<li>元素延迟消失</li>
<li>让下层元素没有点击特性（ pointer-events）/ 不使用具有点击特性的元素</li>
<li>touch 事件改用 click 事件</li>
</ul>
<p>在移动端浏览器存在非常多的默认行为，很多时候会影响我们的开发</p>
<ul>
<li>长按选中文字和图片</li>
<li>下拉时刷新</li>
<li>默认的右键菜单</li>
<li>......</li>
</ul>
<h2>阻止默认行为</h2>
<p>在移动端开发中，对于 <code>touch</code> 事件浏览器存在非常多的默认行为，会影响我们的开发</p>
<ul>
<li>长按选中文字和图片</li>
<li>下拉时刷新</li>
<li>默认的右键菜单</li>
<li>......</li>
</ul>
<p>通常我们一上来就需要阻止掉所有的默认行为，后面的很多功能都需要我们自定义来实现</p>
<pre><code class="language-javascript">document.addEventListener(
  &#x27;touchstart&#x27;, 
  e =&gt; e.preventDefault(), 
  { passive: false }
)
</code></pre>
<p>当阻止这些默认行为之后，会对一些功能产生影响：</p>
<p><em>touchmove</em></p>
<ul>
<li>
<p>阻止了浏览器的滚动条</p>
</li>
<li>
<p>阻止了用户双指缩放</p>
</li>
</ul>
<p><em>touchstart</em></p>
<ul>
<li>解决 <em>IOS10+</em> 及部分安卓机通过设置 <em>viewport</em> 禁止用户缩放的功能（双指滑动、双击）</li>
<li>解决事件点透问题</li>
<li>阻止图片文字被选中</li>
<li>阻止了长按元素会弹出系统菜单</li>
<li>阻止了浏览器回弹的效果</li>
<li>阻止了浏览器的滚动条</li>
<li>阻止了鼠标的事件</li>
<li>阻止了 <em>input</em> 框的输入功能</li>
</ul>
<p>超链接跳转</p>
<pre><code class="language-javascript">document.querySelectorAll(&#x27;a[href]&#x27;)forEach(link =&gt; {
  link.addEventListener(&#x27;touchend&#x27;, () =&gt; {
    location.href = link.href
  })
})
</code></pre>
<p><strong>input 获取焦点</strong></p>
<pre><code class="language-javascript">input.addEventListener(&#x27;touchstart&#x27;, event =&gt; {
  event.stopPropagation()
  // input.focus()
})
</code></pre>
<p><strong>解决部分文字想要被选中</strong></p>
<pre><code class="language-javascript">content = document.querySelector(&#x27;#content&#x27;)
content.addEventListener(&#x27;touchstart&#x27;, event =&gt; {
  event.stopPropagation()
})
content.addEventListener(&#x27;touchmove&#x27;, event =&gt; {
  event.preventDefault()
})
</code></pre>
<h2>passive</h2>
<p>passive event listeners 于 2016 年在 Google I/O 上提出，用于提升页面滑动的流畅度</p>
<p>移动端中如果我们在 <code>touchstart</code> 事件中调用了 <code>preventDefault</code> 那么整个列表的滚动就会被取消</p>
<p>由于浏览器无法预先知道一个事件处理函数中会不会调用 <code>preventDefault</code>，它需要等到事件处理函数执行完后，才能去执行默认行为，然而事件处理函数执行是要耗时的，这样一来就有可能会导致页面卡顿</p>
<p><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2022-03-22-024306.gif" alt=""/></p>
<p>将 <code>addEventListener</code> 的第三个参数设置为<code>{ passive: true }</code>，明确告诉浏览器，事件处理程序不会调用 <code>preventDefault</code> 来阻止默认滑动行为</p>
<p><code>passive</code> 为 <code>true</code> 的事件监听器被称为 <strong>passive event listener</strong>，从 Chrome 51 开始引入</p>
<p>从Chrome 56开始，<code>document</code> 的事件监听器，<code>passive</code> 会被默认设置为 <code>true</code> 以提高性能</p><div><a href="/notes/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8D">cd ..</a></div></div></main><footer class="pb-2 pt-12 text-center shrink-0"><div class="capitalize">copyright <span class="text-2xl align-middle">©</span> <!-- -->2022<!-- --> xie feng</div><div class="text-sm">Powered by NextJS</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metaTitle":"事件","article":{"title":"事件","content":"## 移动端事件\n\n移动端点击触发顺序：touchstart → touchend → mousedown → mouseup → click \n\n当没有设置 `\u003cmeta name=\"viewport\" /\u003e` 的时候\n\n1. 单机 PC 端事件会延迟 300ms 触发\n2. 双击页面会进行缩放，且会触发两次 touchstart、touchend，不会触发 PC 端事件\n\n[changedTouches](changedTouches)\n\n## 事件穿透\n\n在移动端中对于重叠元素，当最顶层元素触发 `touch` 事件之后并消失，下层元素会触发 `click` 事件\n\n### 发生原因\n\n移动端点击事件触发顺序：touchstart -\u003e touchend -\u003e click\n\nclick 事件的滞后性设计导致了上层元素隐藏之后，浏览器触发了 *click* 事件，但是此时上层元素不见了，所以该事件被派发到了下层元素身上\n\n常见的事件穿透场景：\n\n- 目标元素触发触摸事件时隐藏或移除自身，对应位置元素触发 click 事件或 a 链接跳转\n- 目标元素使用触摸事件跳转至新页面，新页面中对应位置元素触发 click 事件或 a 链接跳转\n\n### 解决方法\n\n- 阻止元素的默认行为，后续事件不再触发\n- 全局阻止默认行为（document）\n- 元素延迟消失\n- 让下层元素没有点击特性（ pointer-events）/ 不使用具有点击特性的元素\n- touch 事件改用 click 事件\n\n在移动端浏览器存在非常多的默认行为，很多时候会影响我们的开发\n\n- 长按选中文字和图片\n- 下拉时刷新\n- 默认的右键菜单\n- ......\n\n## 阻止默认行为\n\n在移动端开发中，对于 `touch` 事件浏览器存在非常多的默认行为，会影响我们的开发\n\n- 长按选中文字和图片\n- 下拉时刷新\n- 默认的右键菜单\n- ......\n\n通常我们一上来就需要阻止掉所有的默认行为，后面的很多功能都需要我们自定义来实现\n\n```javascript\ndocument.addEventListener(\n  'touchstart', \n  e =\u003e e.preventDefault(), \n  { passive: false }\n)\n```\n\n当阻止这些默认行为之后，会对一些功能产生影响：\n\n*touchmove*\n\n- 阻止了浏览器的滚动条\n\n- 阻止了用户双指缩放\n\n*touchstart*\n\n- 解决 *IOS10+* 及部分安卓机通过设置 *viewport* 禁止用户缩放的功能（双指滑动、双击）\n- 解决事件点透问题\n- 阻止图片文字被选中\n- 阻止了长按元素会弹出系统菜单\n- 阻止了浏览器回弹的效果\n- 阻止了浏览器的滚动条\n- 阻止了鼠标的事件\n- 阻止了 *input* 框的输入功能\n\n\n\n超链接跳转\n\n```javascript\ndocument.querySelectorAll('a[href]')forEach(link =\u003e {\n  link.addEventListener('touchend', () =\u003e {\n    location.href = link.href\n  })\n})\n```\n\n **input 获取焦点** \n\n```javascript\ninput.addEventListener('touchstart', event =\u003e {\n  event.stopPropagation()\n  // input.focus()\n})\n```\n\n**解决部分文字想要被选中**\n\n```javascript\ncontent = document.querySelector('#content')\ncontent.addEventListener('touchstart', event =\u003e {\n  event.stopPropagation()\n})\ncontent.addEventListener('touchmove', event =\u003e {\n  event.preventDefault()\n})\n```\n\n## passive\n\npassive event listeners 于 2016 年在 Google I/O 上提出，用于提升页面滑动的流畅度\n\n移动端中如果我们在 `touchstart` 事件中调用了 `preventDefault` 那么整个列表的滚动就会被取消\n\n由于浏览器无法预先知道一个事件处理函数中会不会调用 `preventDefault`，它需要等到事件处理函数执行完后，才能去执行默认行为，然而事件处理函数执行是要耗时的，这样一来就有可能会导致页面卡顿\n\n![](https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2022-03-22-024306.gif)\n\n将 `addEventListener` 的第三个参数设置为`{ passive: true }`，明确告诉浏览器，事件处理程序不会调用 `preventDefault` 来阻止默认滑动行为\n\n`passive` 为 `true` 的事件监听器被称为 **passive event listener**，从 Chrome 51 开始引入\n\n从Chrome 56开始，`document` 的事件监听器，`passive` 会被默认设置为 `true` 以提高性能\n\n\n\n\n","meta":{"size":3993,"birthTime":1663496641435.0266,"updateTime":1663496641435.3003}}},"__N_SSG":true},"page":"/notes/[[...param]]","query":{"param":["移动端适配","事件"]},"buildId":"OyucwIrXZRgWNxoAUA9lF","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>