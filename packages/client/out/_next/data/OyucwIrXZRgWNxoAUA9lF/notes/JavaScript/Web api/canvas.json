{"pageProps":{"metaTitle":"canvas","article":{"title":"canvas","content":"vscode 添加 `/** @type {HTMLCanvasElement} **/`  即可拥有 canvas 提示\n\n## 图形\n\n1. 画线\n\n   ```js\n   const canvas = document.getElementById('canvas');\n   const ctx = canvas.getContext('2d');\n   ctx.beginPath();\n   ctx.moveTo(100, 100);\n   ctx.lineTo(200, 200);\n   ctx.stroke();\n   ```\n\n2. 矩形\n\n   ```js\n   ctx.beginPath();\n   ctx.rect(100, 100, 200, 200);\n   ctx.stroke();\n   // or\n   ctx.beginPath();\n   ctx.strokeRect(100, 100, 200, 200);\n   \n   // 填充矩形\n   ctx.beginPath();\n   ctx.fillRect(100, 100, 200, 200);\n   ```\n\n3. 圆弧\n\n   - `arc(x, y, radius, startAngle, endAngle, acticlockwise)`   \n\n     `endAngle` 是顺时针方向来数，开始和结束的弧度都需要传弧度（`Math.PI`），最后一个参数是否逆时针\n\n   ```js\n   ctx.beginPath();\n   ctx.arc(100, 100, 50, 0, 60 * Math.PI / 180, false);\n   ctx.stroke();\n   ```\n\n   - `arcTo(x1, y1, x2, y2, radius)`\n\n     `arcTo()` 方法在画布上创建介于两个切线之间的弧/曲线。\n\n     ![](https://oss.xiefeng.tech/images/20210906202258.png)\n\n   ```js\n   ctx.beginPath();\n   ctx.moveTo(110, 100);\n   ctx.arcTo(200, 100, 200, 150, 10);\n   ctx.arcTo(200, 200, 100, 200, 10);\n   ctx.arcTo(100, 200, 100, 100, 10);\n   ctx.arcTo(100, 100, 200, 100, 10);\n   ctx.stroke();\n   ```\n\n\n\n## 背景填充\n\n背景的填充都是从canvas的原点开始的\n\n1. 纯色填充\n\n   ```js\n   ctx.fillStyle = \"red\";\n   ```\n\n2. 图片填充\n\n   ```js\n   ctx.beginPath();\n   const img = new Image();\n   img.src = './1.jpg';\n   img.onload = function () {\n       const bg = ctx.createPattern(img, 'no-repeat');\n       ctx.fillStyle = bg;\n       ctx.translate(100, 100);\n       ctx.fillRect(0, 0, 200, 200);\n   }\n   ```\n\n3. 线性渐变\n\n   ```js\n   ctx.beginPath();\n   var bg = ctx.createLinearGradient(0, 0, 200, 0);\n   ctx.fillStyle = bg;\n   ctx.translate(100, 100);\n   bg.addColorStop(0, \"white\");\n   bg.addColorStop(0.5, \"black\");\n   bg.addColorStop(1, \"white\");\n   ctx.fillRect(0, 0, 200, 200);\n   ```\n\n4. 辐射渐变\n\n   ```js\n   ctx.beginPath();\n   var bg = ctx.createRadialGradient(100, 100, 0, 100, 100, 100);\n   ctx.fillStyle = bg;\n   ctx.translate(100, 100);\n   bg.addColorStop(0, \"white\");\n   bg.addColorStop(0.5, \"black\");\n   bg.addColorStop(1, \"white\");\n   ctx.fillRect(0, 0, 200, 200);\n   ```\n\n## 其他\n\n1. 阴影\n\n   ```js\n   ctx.shadowColor = \"red\";ctx.shadowBlur = 10;ctx.shadowOffsetX = 0;ctx.shadowOffsetY = 0;ctx.strokeRect(100, 100, 100, 100);\n   ```\n\n2. 文字\n\n   `ctx.strokeText(text, x, y)`    空心文字\n\n   `ctx.font = \"20px consolas\"`\n\n   `ctx.fillText(text, x, y)`   实心文字\n\n   `ctx.textAlign`、`ctx.textBaseline` 设置文字对齐方式\n\n   ![](https://oss.xiefeng.tech/images/20210906202258.png)\n\n3. 线段样式\n\n   ```js\n   ctx.lineCap = \"butt | round | square\";ctx.lineJoin = \"bevel | miter | round\";ctx.miterLimit = 5;\n   ```\n\n4. 属性合成\n\n   `ctx.globalCompositeOperation`  属性设置或返回如何将一个源（新的）图像绘制到目标（已有）的图像上，该属性需要设置在两个图形绘制的中间\n\n   <img src=\"https://oss.xiefeng.tech/images/20210906202258.png\" style=\"zoom: 33%;\" />\n\n   ```js\n   ctx.beginPath();ctx.fillStyle = \"#eee\";ctx.fillRect(100, 100, 100, 100);ctx.globalCompositeOperation = \"source-out\";  // 位置很重要ctx.beginPath();ctx.fillStyle = \"#aaa\";ctx.fillRect(150, 150, 100, 100);\n   ```\n\n## 图像处理\n\n1. 设置图片\n\n   `drawImage()` 方法在画布上绘制图像、画布或视频，也能够绘制图像的某些部分，以及/或者增加或减少图像的尺寸。\n\n   1. 定位\n\n   ```js\n   ctx.drawImage(img,x,y);\n   ```\n\n   1. 在画布上定位图像，并规定图像的宽度和高度\n\n   ```js\n   ctx.drawImage(img,x,y,width,height);\n   ```\n\n   1. 剪切图像，并在画布上定位被剪切的部分\n\n   参数：开始剪切的 x y坐标，被剪切图像的宽高，在画布上放置图像的坐标，要使用的图像的宽高（放大/缩小）\n\n   ```js\n   ctx.drawImage(img,sx,sy,swidth,sheight,x,y,width,height);\n   ```\n\n2. 将 canvas 导出为图片\n\n   `canvas.toDataURL()` 可以将该 canvas 的整个内容导出为一个base64的图片\n\n3. 得到图片的信息\n\n   `ctx.getImageData(x, y, width, height)` 可以得到指定区域的像素点信息\n\n   `ctx.putImageData(imgData,x,y,dirtyX,dirtyY,dirtyWidth,dirtyHeight)` 将图像数据（从指定的 `ImageData` 对象）放回画布上\n\n   参数：`ImageData` 对象左上角的坐标，在画布上放置图像的位置（可选），在画布上绘制图像所使用的宽高（可选）\n\n\n\n## 尺寸设置\n\nCanvas 的默认大小为 300 × 150，元素实际在页面中占据的大小由 CSS 控制\n\n画布会伸缩以适应 CSS 所设置的尺寸，当画布尺寸和 CSS 尺寸比例不一致时会出现扭曲\n\n元素大小默认等于设置的画布大小（无 CSS 设置宽高的情况）\n\n当改变画布的长度或者宽度时，画布中的内容会被清空，上下文对象的属性值会被重置\n\n## 画布状态\n\nCanvasRenderingContext2D 包含了多种绘图的样式状态（线的样式、填充样式、阴影样式等）\n\n- `save` 将当前 canvas 的状态压入绘图堆栈中，保存目前 canvas 的状态\n\n- `restore` 从绘图堆栈中弹出上一个 canvas 状态，恢复之前的绘图状态\n\n存储在状态堆栈的数据列表：\n\n- 坐标变换（变换矩阵）信息\n- 剪贴区域\n- 渲染上下文对象（`CanvasRenderingContext2D`）的属性值\n\n> [`strokeStyle`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/strokeStyle), [`fillStyle`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillStyle), [`globalAlpha`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/globalAlpha), [`lineWidth`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineWidth), [`lineCap`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineCap), [`lineJoin`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineJoin), [`miterLimit`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/miterLimit), [`lineDashOffset`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset), [`shadowOffsetX`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX), [`shadowOffsetY`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY), [`shadowBlur`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowBlur), [`shadowColor`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowColor), [`globalCompositeOperation`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation), [`font`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/font), [`textAlign`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textAlign), [`textBaseline`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textBaseline), [`direction`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/direction), [`imageSmoothingEnabled`](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled)\n\n## 路径\n\n### beginPath\n\n`beginPath` 方法用于开始一段新路径\n\ncanvas 中的绘制方法（`stroke`、`fill` 等）都会以上一次 `beginPath` 之后的所有路径为基础进行绘制\n\n1. 无论使用 `moveTo` 把画笔移动到哪里，只要没有 `beginPath`，都是在画一条路径\n2. `fillRect` 与 `strokeRect` 这种直接画出独立区域的函数，也不会打断当前的路径\n\n```javascript\nctx.beginPath()\nctx.moveTo(100.5, 20.5)\nctx.lineTo(200.5, 20.5)\nctx.stroke()\n\ndebugger\nctx.moveTo(100.5, 40.5)\nctx.lineTo(200.5, 40.5)\nctx.strokeStyle = '#f00'\nctx.stroke()\n```\n\n这段代码绘制出的图案是两条红线，因为两次 stroke 都是以 beginPath 后的所有路径为基础画的\n\n第一条路径 stroke 了两下，第一下是黑的，第二下是红的，所以最终也是红的\n\n![](/Users/xiefeng/Library/Application Support/typora-user-images/image-20220731165857256.png)\n\n![](/Users/xiefeng/Library/Application Support/typora-user-images/image-20220731170011798.png)\n\n## 变形\n\n`translate(x, y)` 将 canvas 的原点进行移动\n\n```javascript\nfor (let i = 0; i < 3; i++) {\n  for (let j = 0; j < 3; j++) {\n    ctx.save()\n    ctx.fillStyle = `rgb(${51 * i}, ${255 - 51 * i}, 255)`\n    ctx.translate(10 + j * 50, 10 + i * 50)\n    ctx.fillRect(0, 0, 25, 25)\n    ctx.restore()\n  }\n}\n```\n\n`rotate(angle)` 将坐标轴顺时针旋转指定的弧度\n\n- 参数计算方式 `degree * Math.PI / 180` \n- 旋转中心点为 canvas 的原点\n\n`scale(x, y)`  可以缩放画布的水平和垂直的单位\n\n- x 为水平缩放因子，y 为垂直缩放因子\n- 如果比 1 小，会缩小图形，如果比 1 大会放大图形\n- 默认值为 1，为实际大小\n\n`transform(a, b, c, d, e, f)`  用于使用矩阵多次叠加当前变换\n\n- 该方法是将当前的变形矩阵乘上一个基于自身参数的矩阵（每调用 transform 都会在前一个变换矩阵上构建）\n- 可以缩放、旋转、移动和倾斜上下文\n- `setTransform` 使用单位矩阵重新设置（覆盖）当前的变换\n- `resetTransform` 重置坐标轴的变换\n\n矩阵：\n\n```javascript\na  c  e             x\nb  d  f      *      y\n0  0  1             1\n```\n\n![](/Users/xiefeng/Library/Application Support/typora-user-images/image-20220731213302126.png)\n\n## path2D\n\n\n\n\n\n\n\n## 绘制平滑曲线\n\n由于浏览器对 `mousemove` 事件的采集频率，使用 `lineTo` 无法绘制平滑的曲线\n\n可以通过 `quadraticCurveTo` 绘制二次贝塞尔曲线的方式绘制出平滑曲线\n\n![](https://img2020.cnblogs.com/blog/449809/202008/449809-20200803174427946-1862846632.png)\n\nhttps://segmentfault.com/a/1190000016672567\n\n\n\n","meta":{"size":10014,"birthTime":1663496641399.6614,"updateTime":1663496641400.0774}}},"__N_SSG":true}